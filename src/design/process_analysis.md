
# 业务流程的分析

- 用户的个人信息表存在积分属性，可以用来进行抽奖，针对各个奖品类型，会消耗相应的积分数

- 通过后台管理系统进行活动信息和奖品信息的配置

- 用户点击抽奖，后端返回有效时间内的所有活动信息和奖品信息，每个奖品存在抽奖按钮

- 用于点击相应奖品的按钮，向后端传输该奖品对应的id标识

- 后端获取抽奖请求，进行数据处理

　- 修改用户抽奖统计信息表，用于记录用户的抽奖次数，以及计算相应的百分比，表示该用户抽奖次数占所有抽奖用户的百分位数

　- 创建此次抽奖的明细表，用于记录此次抽奖的奖品，以及此奖品所返回给用户的递增的抽奖号码,以及标识用户是否中奖和积分更新

　注释：　一个人可以多次抽奖，每个奖品都自己的递增方式和总的抽奖次数，即每个奖品存在一个中奖号码

- 当到达开奖日期时，后端查询上证指数和深证指数，以及每个奖品的总次数，计算每个奖品的中奖号码

- 根据奖品类型和中奖号，查询出中奖的明细表中的行，将中奖标识位设置为真

- 向中奖的用户发送消息推送通知

# 基于上述流程的分析，提出两种方案：

### 不考虑高并发的简易版的设计思路（已实现），见simple_design.md

### 考虑高并发的情况（未实现）

- 采用Nginx来进行反向前端代理，设定相应的配置信息，提供相应的负载均衡

- 多人抽奖，计算用户的百分比压力会很大，需进行相应的优化
　
    - 用redis等消息缓存存储用户的抽奖统计信息

        - 当用户抽奖后，先修改缓存数据，返回用户

        - 用消息队列异步写入数据，异步写入完成后，刷新缓存数据